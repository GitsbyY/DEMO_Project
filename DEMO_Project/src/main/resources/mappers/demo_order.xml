<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.demo.order">
	<resultMap type="orderDto" id="orderResultMap">
		<id column="ORDER_NO" property="orderNo" />
		<result column="MEMBER_NO" property="memberNo" />
		<result column="ORDER_DATE" property="orderDate"
			javaType="java.util.Date" />
		<result column="ORDER_REQUEST" property="orderRequest" />
		<result column="ORDER_STATUS" property="orderStatus" />
		<result column="ORDER_TOTALPRICE" property="orderTotalPrice" />
	</resultMap>

	<resultMap type="orderProductDto" id="orderProductResultMap">
		<id column="ORDER_NO" property="orderNo" />
		<result column="PRODUCT_NO" property="productNo" />
		<result column="PRODUCT_NAME" property="productName" />
		<result column="PRODUCT_QUANTITY" property="productQuantity" />
		<result column="PRODUCT_PRICE" property="productPrice" />
	</resultMap>

	<resultMap type="orderConfirmDto" id="orderConfirmResultMap">
		<id column="ORDER_NO" property="orderNo" />
		<result column="ORDER_CONFIRM_DATE" property="orderConfirmDate"
			javaType="java.util.Date" />
	</resultMap>

	<resultMap type="orderCancelDto" id="orderCancelResultMap">
		<id column="ORDER_NO" property="orderNo" />
		<result column="ORDER_CANCEL_DATE" property="orderCancelDate"
			javaType="java.util.Date" />
	</resultMap>

	<select id="orderSelectList" parameterType="map" 
		resultType="map">
		SELECT L.ORDER_DATE, L.ORDER_NO, L.MEMBER_NO, L.MEMBER_ID, L.product_name
		FROM(
    		SELECT ROWNUM AS RNUM, OL.ORDER_DATE, OL.ORDER_NO, M.MEMBER_NO, M.MEMBER_ID, OP.product_name
    		FROM ORDER_LIST OL
    		JOIN MEMBER M ON OL.MEMBER_NO = M.MEMBER_NO
    		JOIN ORDER_PRODUCT OP ON OL.ORDER_NO = OP.ORDER_NO
   			ORDER BY ORDER_DATE DESC) L
		WHERE L.RNUM BETWEEN #{start} AND #{end}
	</select>

	<select id="orderDetailSelectOne" resultType="map">
		SELECT OL.ORDER_DATE, OL.ORDER_NO, M.MEMBER_NO, M.MEMBER_ID
		, OP.product_name, pd.img_no, pd.product_detail_content
		, pr.product_price, ol.order_status
		FROM ORDER_LIST OL
		JOIN MEMBER M ON OL.MEMBER_NO = M.MEMBER_NO
		JOIN ORDER_PRODUCT OP ON OL.ORDER_NO = OP.ORDER_NO
		JOIN PRODUCT PR ON OP.PRODUCT_NO = PR.PRODUCT_NO
		JOIN PRODUCT_DETAIL PD ON PR.PRODUCT_DETAIL_NO = PD.PRODUCT_DETAIL_NO
		WHERE OL.ORDER_NO = #{orderNo}
	</select>
	
	
	<select id="orderSelectListTotalCount" resultType="java.lang.Integer">
	SELECT COUNT(*)
	FROM ORDER_LIST OL
	JOIN MEMBER M ON OL.MEMBER_NO = M.MEMBER_NO
	JOIN ORDER_PRODUCT OP ON OL.ORDER_NO = OP.ORDER_NO
	</select>

</mapper>



